{"version":3,"sources":["ui.coffee"],"names":[],"mappings":"AAIA;AAAA;;GAAA;AAAA;AAAA;AAAA,MAAA,+BAAA;;AAAA,EAGM;AACS,IAAA,eAAC,GAAD,GAAA;AACX,MADY,IAAC,CAAA,MAAD,GACZ,CAAA;AAAA,MAAA,IAAC,CAAA,GAAD,GAAU,IAAC,CAAA,GAAG,CAAC,IAAL,CAAU,KAAV,CAAV,CAAA;AAAA,MACA,IAAC,CAAA,KAAD,GAAU,IAAC,CAAA,GAAG,CAAC,IAAL,CAAU,OAAV,CADV,CAAA;AAAA,MAEA,IAAC,CAAA,MAAD,GAAU,IAAC,CAAA,GAAG,CAAC,IAAL,CAAU,QAAV,CAFV,CAAA;AAAA,MAGA,IAAC,CAAA,GAAD,GAAU,IAAC,CAAA,GAAG,CAAC,IAAL,CAAU,KAAV,CAHV,CAAA;AAAA,MAKA,IAAC,CAAA,GAAG,CAAC,GAAL,CACE;AAAA,QAAA,UAAA,EAAY,UAAZ;OADF,CALA,CAAA;AAAA,MAQA,IAAC,CAAA,KAAD,GAAS,MAAA,CAAO,OAAP,CACP,CAAC,QADM,CACG,MADH,CAEP,CAAC,GAFM,CAGL;AAAA,QAAA,kBAAA,EAAoB,IAAC,CAAA,GAArB;AAAA,QACA,UAAA,EAAY,UADZ;AAAA,QAEA,KAAA,EAAO,CAFP;AAAA,QAGA,MAAA,EAAQ,CAHR;AAAA,QAIA,OAAA,EAAS,CAJT;AAAA,QAKA,QAAA,EAAU,CALV;OAHK,CASP,CAAC,QATM,CASG,IAAC,CAAA,GATJ,CART,CADW;IAAA,CAAb;;AAAA,oBAoBA,WAAA,GAAa,SAAC,KAAD,EAAQ,MAAR,GAAA;aACR,IAAC,CAAA,GAAF,GAAM,GAAN,GAAS,KAAT,GAAe,IAAf,GAAmB,MAAnB,GAA0B,cADjB;IAAA,CApBb,CAAA;;AAAA,oBAuBA,GAAA,GAAK,SAAC,IAAD,EAAO,GAAP,EAAY,KAAZ,EAAmB,MAAnB,GAAA;aACH,IAAC,CAAA,GAAG,CAAC,GAAL,CACE;AAAA,QAAA,MAAA,EAAW,IAAC,CAAA,WAAD,GAAe,IAA1B;AAAA,QACA,KAAA,EAAW,IAAC,CAAA,UAAD,GAAc,GADzB;AAAA,QAEA,OAAA,EAAW,IAAC,CAAA,YAAD,GAAgB,KAF3B;AAAA,QAGA,QAAA,EAAW,IAAC,CAAA,aAAD,GAAiB,MAH5B;OADF,EADG;IAAA,CAvBL,CAAA;;AAAA,oBA8BA,SAAA,GAAW,SAAA,GAAA;AACT,MAAA,IAAU,CAAA,IAAK,CAAA,GAAG,CAAC,YAAL,CAAA,CAAd;AAAA,cAAA,CAAA;OAAA;aACA,IAAC,CAAA,IAAD,CAAA,EAFS;IAAA,CA9BX,CAAA;;AAAA,oBAkCA,IAAA,GAAM,SAAA,GAAA;AACJ,UAAA,SAAA;AAAA,MAAA,IAAU,IAAC,CAAA,MAAX;AAAA,cAAA,CAAA;OAAA;AAAA,MACA,IAAC,CAAA,MAAD,GAAU,IADV,CAAA;AAAA,MAGA,CAAA,GAAI,IAAI,CAAC,KAAL,CAAW,IAAC,CAAA,YAAZ,CAHJ,CAAA;AAAA,MAIA,CAAA,GAAI,IAAI,CAAC,KAAL,CAAW,IAAC,CAAA,aAAZ,CAJJ,CAAA;aAMA,GAAA,GAAM,MAAA,CAAO,OAAP,CACJ,CAAC,IADG,CACE,KADF,EACS,IAAC,CAAA,WAAD,CAAa,CAAb,EAAgB,CAAhB,CADT,CAEJ,CAAC,IAFG,CAEE,WAFF,EAEe,KAFf,CAGJ,CAAC,GAHG,CAIF;AAAA,QAAA,SAAA,EAAW,CAAX;AAAA,QACA,OAAA,EAAS,MADT;AAAA,QAEA,QAAA,EAAU,MAFV;OAJE,CAOJ,CAAC,EAPG,CAOA,MAPA,EAOQ,CAAA,SAAA,KAAA,GAAA;eAAA,SAAA,GAAA;iBACV,GAAG,CAAC,OAAJ,CACE;AAAA,YAAA,SAAA,EAAW,CAAX;WADF,EAEE,GAFF,EAEO,SAAA,GAAA;mBACL,KAAC,CAAA,KAAK,CAAC,GAAP,CAAW,YAAX,EAAyB,MAAzB,EADK;UAAA,CAFP,EADU;QAAA,EAAA;MAAA,CAAA,CAAA,CAAA,IAAA,CAPR,CAYJ,CAAC,QAZG,CAYM,IAAC,CAAA,KAZP,EAPF;IAAA,CAlCN,CAAA;;AAAA,oBAuDA,MAAA,GAAQ,SAAA,GAAA;aACN,IAAC,CAAA,GAAG,CAAC,MAAL,CAAA,EADM;IAAA,CAvDR,CAAA;;iBAAA;;MAJF,CAAA;;AA8DA;AAAA;;;;;;;;;;;;;;;;;;KA9DA;;AAAA,EAiFM;AACS,IAAA,mBAAC,GAAD,EAAO,MAAP,GAAA;AACX,UAAA,iBAAA;AAAA,MADY,IAAC,CAAA,MAAD,GACZ,CAAA;;QADkB,SAAS;OAC3B;AAAA,MAAA,IAAC,CAAA,SAAD,GAAa,MAAM,CAAC,QAAP,IAAmB,MAAA,CAAO,QAAP,CAAhC,CAAA;AAAA,MACA,IAAC,CAAA,MAAD,GAAc,IAAA,CAAC,MAAM,CAAC,MAAP,IAAiB,UAAlB,CAAA,CAA8B,IAA9B,CADd,CAAA;AAAA,MAGA,IAAC,CAAA,GAAG,CAAC,GAAL,CACE;AAAA,QAAA,UAAA,EAAY,UAAZ;OADF,CAHA,CAAA;AAAA,MAMA,IAAC,CAAA,UAAD,GAAc,EANd,CAAA;AAOA;AAAA,WAAA,uCAAA;qBAAA;AACE,QAAA,IAAC,CAAA,SAAD,CAAW,MAAA,CAAO,GAAP,CAAX,CAAA,CADF;AAAA,OAPA;AAAA,MAUA,IAAC,CAAA,aAAD,GAAiB,IAAC,CAAA,GAAG,CAAC,IAAL,CAAU,eAAV,CAVjB,CAAA;AAAA,MAWA,IAAC,CAAA,WAAD,CAAA,CAXA,CADW;IAAA,CAAb;;AAAA,wBAcA,WAAA,GAAa,SAAA,GAAA;aACX,IAAC,CAAA,SAAS,CAAC,EAAX,CAAc,QAAd,EAAwB,CAAA,SAAA,KAAA,GAAA;eAAA,SAAC,GAAD,GAAA;AACtB,UAAA,KAAC,CAAA,gBAAD,CAAA,CAAA,CAAA;AACA,UAAA,IAAgB,KAAC,CAAA,MAAM,CAAC,cAAR,CAAA,CAAhB;mBAAA,KAAC,CAAA,SAAD,CAAA,EAAA;WAFsB;QAAA,EAAA;MAAA,CAAA,CAAA,CAAA,IAAA,CAAxB,EADW;IAAA,CAdb,CAAA;;AAAA,wBAmBA,SAAA,GAAW,SAAC,MAAD,GAAA;AACT,UAAA,GAAA;AAAA,MAAA,GAAA,GAAU,IAAA,KAAA,CAAM,MAAN,CAAV,CAAA;AAAA,MACA,MAAA,CAAO,OAAP,CACE,CAAC,QADH,CACY,QADZ,CAEE,CAAC,QAFH,CAEY,GAAG,CAAC,GAFhB,CADA,CAAA;aAIA,IAAC,CAAA,UAAW,CAAA,MAAM,CAAC,IAAP,CAAY,IAAZ,CAAA,CAAZ,GAAiC,IALxB;IAAA,CAnBX,CAAA;;AAAA,wBA0BA,cAAA,GAAgB,SAAC,GAAD,GAAA;AACd,UAAA,gBAAA;AAAA,WAAA,uCAAA;oBAAA;AACE,QAAA,GAAA,GAAM,IAAC,CAAA,UAAW,CAAA,EAAA,CAAlB,CAAA;AAAA,QACA,GAAG,CAAC,MAAJ,CAAA,CADA,CAAA;AAAA,QAEA,MAAA,CAAA,IAAQ,CAAA,UAAW,CAAA,EAAA,CAFnB,CADF;AAAA,OAAA;aAIA,IAAC,CAAA,MAAD,CAAA,EALc;IAAA,CA1BhB,CAAA;;AAAA,wBAoCA,UAAA,GAAY,SAAC,IAAD,GAAA;AAGV,UAAA,0BAAA;AAAA,MAAA,GAAA,GAAM,CAAN,CAAA;AACA;AAAA;WAAA,SAAA;sBAAA;AACE,QAAA,IAAA,CAAK,GAAL,EAAU,GAAV,CAAA,CAAA;AAAA,qBACA,GAAA,GADA,CADF;AAAA;qBAJU;IAAA,CApCZ,CAAA;;AAAA,wBA6CA,MAAA,GAAQ,SAAA,GAAA;AACN,MAAA,IAAC,CAAA,MAAM,CAAC,MAAR,CAAA,CAAA,CAAA;aACA,UAAA,CAAW,SAAA,GAAA;eACT,MAAA,CAAO,OAAP,CAAe,CAAC,YAAhB,CAA6B;AAAA,UAC3B,aAAA,EAAe,IADY;SAA7B,EADS;MAAA,CAAX,EAFM;IAAA,CA7CR,CAAA;;AAAA,wBAqDA,gBAAA,GAAkB,SAAA,GAAA;AAChB,UAAA,uBAAA;AAAA;AAAA;WAAA,SAAA;wBAAA;AAAA,qBAAA,KAAK,CAAC,SAAN,CAAA,EAAA,CAAA;AAAA;qBADgB;IAAA,CArDlB,CAAA;;AAAA,wBAwDA,SAAA,GAAW,SAAA,GAAA;aACT,IAAC,CAAA,GAAG,CAAC,KAAL,CAAA,EADS;IAAA,CAxDX,CAAA;;AAAA,wBA2DA,SAAA,GAAW,SAAA,GAAA;AACT,UAAA,IAAA;AAAA,MAAA,IAAU,IAAC,CAAA,GAAG,CAAC,QAAL,CAAc,KAAd,CAAV;AAAA,cAAA,CAAA;OAAA;AACA,MAAA,IAAU,IAAC,CAAA,GAAG,CAAC,QAAL,CAAc,SAAd,CAAV;AAAA,cAAA,CAAA;OADA;AAAA,MAEA,IAAC,CAAA,GAAG,CAAC,QAAL,CAAc,SAAd,CAFA,CAAA;AAAA,MAGA,IAAA,GAAO,IAAC,CAAA,GAAG,CAAC,IAAL,CAAU,MAAV,CAAA,IAAqB,CAH5B,CAAA;aAIA,MAAM,CAAC,IAAP,CACE;AAAA,QAAA,GAAA,EAAK,IAAC,CAAA,aAAN;AAAA,QACA,IAAA,EAAM,KADN;AAAA,QAEA,IAAA,EACE;AAAA,UAAA,IAAA,EAAM,IAAA,GAAO,CAAb;SAHF;AAAA,QAIA,OAAA,EAAS,CAAA,SAAA,KAAA,GAAA;iBAAA,SAAC,GAAD,GAAA;AACP,gBAAA,OAAA;AAAA,YAAA,OAAA,GAAU,MAAA,CAAO,GAAP,CAAW,CAAC,IAAZ,CAAiB,sBAAjB,CAAV,CAAA;AAEA,YAAA,IAAG,OAAO,CAAC,MAAX;AACE,cAAA,OAAO,CAAC,IAAR,CAAa,SAAC,GAAD,EAAM,EAAN,GAAA;AACX,oBAAA,UAAA;AAAA,gBAAA,MAAA,GAAS,MAAA,CAAO,EAAP,CAAT,CAAA;AAAA,gBACA,EAAA,GAAK,MAAM,CAAC,IAAP,CAAY,IAAZ,CADL,CAAA;AAAA,gBAEA,MAAM,CAAC,IAAP,CAAY,IAAZ,EAAkB,EAAA,GAAG,EAAH,GAAQ,IAA1B,CAFA,CAAA;AAAA,gBAGA,KAAC,CAAA,GAAG,CAAC,MAAL,CAAY,MAAZ,CAHA,CAAA;uBAIA,KAAC,CAAA,SAAD,CAAW,MAAX,EALW;cAAA,CAAb,CAAA,CAAA;AAAA,cAOA,KAAC,CAAA,MAAD,CAAA,CAPA,CAAA;AAAA,cAQA,KAAC,CAAA,GAAG,CAAC,WAAL,CAAiB,SAAjB,CARA,CAAA;qBASA,KAAC,CAAA,GAAG,CAAC,IAAL,CAAU,MAAV,EAAkB,IAAA,GAAO,CAAzB,EAVF;aAAA,MAAA;AAaE,cAAA,KAAC,CAAA,GAAG,CAAC,WAAL,CAAiB,SAAjB,CAAA,CAAA;qBACA,KAAC,CAAA,GAAG,CAAC,QAAL,CAAc,KAAd,EAdF;aAHO;UAAA,EAAA;QAAA,CAAA,CAAA,CAAA,IAAA,CAJT;OADF,EALS;IAAA,CA3DX,CAAA;;qBAAA;;MAlFF,CAAA;;AAAA,EA+KM;AACS,IAAA,uBAAC,GAAD,GAAA;AACX,MADY,IAAC,CAAA,MAAD,GACZ,CAAA;AAAA,MAAA,IAAC,CAAA,WAAD,CAAA,CAAA,CADW;IAAA,CAAb;;AAAA,4BAGA,WAAA,GAAa,SAAA,GAAA;AACX,UAAA,IAAA;AAAA,MAAA,IAAA,GAAO,IAAP,CAAA;AAAA,MACA,IAAC,CAAA,GAAG,CAAC,EAAL,CAAQ,OAAR,EAAiB,gBAAjB,EAAmC,SAAA,GAAA;AACjC,QAAA,MAAA,CAAO,IAAP,CAAY,CAAC,WAAb,CAAyB,UAAzB,CAAA,CAAA;eACA,IAAI,CAAC,gBAAL,CAAA,EAFiC;MAAA,CAAnC,CADA,CAAA;aAKA,MAAA,CAAO,sBAAP,CAA8B,CAAC,EAA/B,CAAkC,OAAlC,EAA2C,SAAA,GAAA;AACzC,YAAA,YAAA;AAAA,QAAA,YAAA,GAAe,MAAA,CAAO,IAAP,CAAY,CAAC,OAAb,CAAqB,cAArB,CAAf,CAAA;AACA,QAAA,IAAG,YAAY,CAAC,QAAb,CAAsB,MAAtB,CAAA,IAAiC,YAAY,CAAC,QAAb,CAAsB,MAAtB,CAApC;AACE,UAAA,IAAI,CAAC,GAAG,CAAC,IAAT,CAAc,gBAAd,CAA+B,CAAC,QAAhC,CAAyC,UAAzC,CAAA,CAAA;AAAA,UACA,IAAI,CAAC,gBAAL,CAAA,CADA,CAAA;AAEA,gBAAA,CAHF;SADA;AAKA,QAAA,IAAG,YAAY,CAAC,QAAb,CAAsB,KAAtB,CAAH;AACE,UAAA,IAAI,CAAC,GAAG,CAAC,IAAT,CAAc,gBAAd,CAA+B,CAAC,WAAhC,CAA4C,UAA5C,CAAA,CAAA;AAAA,UACA,IAAI,CAAC,gBAAL,CAAA,CADA,CADF;SANyC;MAAA,CAA3C,EANW;IAAA,CAHb,CAAA;;AAAA,4BAoBA,gBAAA,GAAkB,SAAA,GAAA;AAChB,UAAA,kBAAA;AAAA,MAAA,MAAA,GAAS,IAAC,CAAA,GAAG,CAAC,IAAL,CAAU,yBAAV,CAAoC,CAAC,MAA9C,CAAA;AAAA,MACA,UAAA,GAAa,IAAC,CAAA,GAAG,CAAC,IAAL,CAAU,gBAAV,CAA2B,CAAC,MADzC,CAAA;AAAA,MAEA,MAAA,CAAO,4BAAP,CAAoC,CAAC,IAArC,CAA0C,MAA1C,CAFA,CAAA;AAAA,MAGA,MAAA,CAAO,qBAAP,CAA6B,CAAC,WAA9B,CAA0C,eAA1C,CAHA,CAAA;AAIA,MAAA,IAAG,MAAA,KAAU,CAAb;AACE,QAAA,MAAA,CAAO,qBAAP,CAA6B,CAAC,QAA9B,CAAuC,MAAvC,CAAA,CADF;OAAA,MAEK,IAAG,MAAA,GAAS,UAAZ;AACH,QAAA,MAAA,CAAO,qBAAP,CAA6B,CAAC,QAA9B,CAAuC,MAAvC,CAAA,CADG;OAAA,MAAA;AAGH,QAAA,MAAA,CAAO,qBAAP,CAA6B,CAAC,QAA9B,CAAuC,KAAvC,CAAA,CAHG;OANL;AAWA,MAAA,IAAG,MAAA,GAAS,CAAZ;eACE,MAAA,CAAO,oBAAP,CAA4B,CAAC,WAA7B,CAAyC,UAAzC,EADF;OAAA,MAAA;eAGE,MAAA,CAAO,oBAAP,CAA4B,CAAC,QAA7B,CAAsC,UAAtC,EAHF;OAZgB;IAAA,CApBlB,CAAA;;AAAA,4BAqCA,YAAA,GAAc,SAAA,GAAA;aACZ,IAAC,CAAA,GAAG,CAAC,IAAL,CAAU,yBAAV,CAAoC,CAAC,OAArC,CAA6C,QAA7C,EADY;IAAA,CArCd,CAAA;;yBAAA;;MAhLF,CAAA;;AAAA,EAyNA,MAAA,CAAO,QAAP,CAAgB,CAAC,EAAjB,CAAoB,iBAApB,EAAuC,SAAA,GAAA;AACrC,QAAA,uCAAA;AAAA,IAAA,IAAG,MAAA,CAAO,eAAP,CAAuB,CAAC,MAA3B;AACE,MAAA,EAAA,GAAS,IAAA,SAAA,CAAU,MAAA,CAAO,eAAP,CAAV,EAAmC;AAAA,QAE1C,MAAA,EAAQ,UAFkC;AAAA,QAG1C,QAAA,EAAU,MAAA,CAAO,qBAAP,CAHgC;OAAnC,CAAT,CAAA;AAAA,MAMA,EAAE,CAAC,MAAH,CAAA,CANA,CAAA;AAAA,MAQA,MAAA,CAAO,MAAP,CACE,CAAC,GADH,CACO,QADP,CAEE,CAAC,EAFH,CAEM,QAFN,EAEgB,SAAA,GAAA;eACZ,EAAE,CAAC,MAAH,CAAA,EADY;MAAA,CAFhB,CARA,CAAA;AAAA,MAaA,GAAA,GAAU,IAAA,aAAA,CAAc,MAAA,CAAO,eAAP,CAAd,CAbV,CAAA;AAAA,MAmBA,aAAA,GAAoB,IAAA,MAAA,CAAO,MAAA,CAAO,yBAAP,CAAP,CAnBpB,CAAA;AAAA,MAoBA,MAAA,CAAO,sBAAP,CAA8B,CAAC,EAA/B,CAAkC,OAAlC,EAA2C,SAAA,GAAA;eACzC,aAAa,CAAC,IAAd,CAAmB,SAAA,GAAA;AACjB,cAAA,GAAA;AAAA,UAAA,GAAA,GAAM,GAAG,CAAC,YAAJ,CAAA,CAAkB,CAAC,MAAzB,CAAA;AAAA,UACA,aAAa,CAAC,MAAM,CAAC,IAArB,CAA0B,QAA1B,CAAmC,CAAC,IAApC,CAAyC,GAAzC,CADA,CAAA;iBAEA,aAAa,CAAC,OAAd,CAAsB,SAAA,GAAA;AACpB,gBAAA,UAAA;AAAA,YAAA,GAAA;;AAAM;AAAA;mBAAA,uCAAA;+BAAA;AACJ,6BAAA,MAAA,CAAO,KAAP,CAAa,CAAC,IAAd,CAAmB,IAAnB,EAAA,CADI;AAAA;;gBAAN,CAAA;AAAA,YAEA,OAAO,CAAC,GAAR,CAAY,GAAZ,CAFA,CAAA;mBAGA,MAAM,CAAC,IAAP,CACE;AAAA,cAAA,GAAA,EAAK,GAAL;AAAA,cACA,IAAA,EACE;AAAA,gBAAA,GAAA,EAAK,GAAL;eAFF;AAAA,cAGA,OAAA,EAAS,SAAC,GAAD,GAAA;AACP,gBAAA,EAAE,CAAC,cAAH,CAAkB,GAAlB,CAAA,CAAA;AAAA,gBACA,aAAa,CAAC,KAAd,CAAA,CADA,CAAA;uBAEA,GAAG,CAAC,gBAAJ,CAAA,EAHO;cAAA,CAHT;aADF,EAJoB;UAAA,CAAtB,EAHiB;QAAA,CAAnB,EADyC;MAAA,CAA3C,CApBA,CAAA;AAAA,MAsCA,eAAA,GAAsB,IAAA,MAAA,CAAO,MAAA,CAAO,2BAAP,CAAP,CAtCtB,CAAA;aAuCA,MAAA,CAAO,wBAAP,CAAgC,CAAC,EAAjC,CAAoC,OAApC,EAA6C,SAAA,GAAA;eAC3C,eAAe,CAAC,IAAhB,CAAqB,SAAA,GAAA;AACnB,cAAA,GAAA;AAAA,UAAA,GAAA,GAAM,GAAG,CAAC,YAAJ,CAAA,CAAkB,CAAC,MAAzB,CAAA;AAAA,UACA,eAAe,CAAC,MAAM,CAAC,IAAvB,CAA4B,QAA5B,CAAqC,CAAC,IAAtC,CAA2C,GAA3C,CADA,CAAA;iBAEA,eAAe,CAAC,OAAhB,CAAwB,SAAA,GAAA;AACtB,gBAAA,UAAA;AAAA,YAAA,GAAA;;AAAM;AAAA;mBAAA,uCAAA;+BAAA;AACJ,6BAAA,MAAA,CAAO,KAAP,CAAa,CAAC,IAAd,CAAmB,IAAnB,EAAA,CADI;AAAA;;gBAAN,CAAA;AAAA,YAEA,OAAO,CAAC,GAAR,CAAY,GAAZ,CAFA,CAAA;mBAGA,KAAA,CAAM,IAAN,EAJsB;UAAA,CAAxB,EAHmB;QAAA,CAArB,EAD2C;MAAA,CAA7C,EAxCF;KADqC;EAAA,CAAvC,CAzNA,CAAA;;AAAA,EA6QA,MAAA,CAAO,QAAP,CAAgB,CAAC,EAAjB,CAAoB,OAApB,EAA6B,cAA7B,EAA6C,SAAA,GAAA;AAC3C,QAAA,MAAA;AAAA,IAAA,MAAA,GAAS,MAAA,CAAO,eAAP,CAAT,CAAA;WACA,MAAM,CAAC,QAAP,CAAgB,QAAhB,EAF2C;EAAA,CAA7C,CA7QA,CAAA;;AAAA,EAiRA,MAAA,CAAO,QAAP,CAAgB,CAAC,EAAjB,CAAoB,OAApB,EAA6B,eAA7B,EAA8C,SAAA,GAAA;AAC5C,QAAA,MAAA;AAAA,IAAA,MAAA,GAAS,MAAA,CAAO,eAAP,CAAT,CAAA;WACA,MAAM,CAAC,WAAP,CAAmB,QAAnB,EAF4C;EAAA,CAA9C,CAjRA,CAAA;AAAA","file":"ui.js","sourceRoot":"/source/","sourcesContent":["# 可能会用到 turbolinks\r\n# turbolinks 事件加载参考\r\n# https://github.com/rails/turbolinks/#no-jquery-or-any-other-library\r\n\r\n###\r\n  图片加载类\r\n###\r\nclass Image\r\n  constructor: (@$el)->\r\n    @ave    = @$el.data 'ave' # 平均色值\r\n    @width  = @$el.data 'width' # 原始宽\r\n    @height = @$el.data 'height' # 原始高\r\n    @url    = @$el.data 'url' # 原始地址\r\n\r\n    @$el.css\r\n      'position': 'absolute'\r\n\r\n    @$ibox = jQuery('<div>')\r\n      .addClass 'ibox'\r\n      .css \r\n        'background-color': @ave\r\n        'position': 'absolute'\r\n        'top': 0\r\n        'left': 0\r\n        'right': 0\r\n        'bottom': 0\r\n      .appendTo @$el\r\n\r\n  get_png_url: (width, height)->\r\n    \"#{@url}@#{width}w_#{height}h_1e_1c.png\"\r\n\r\n  pos: (left, top, width, height)->\r\n    @$el.css\r\n      'left'   : @layout_left = left\r\n      'top'    : @layout_top = top\r\n      'width'  : @layout_width = width\r\n      'height' : @layout_height = height\r\n\r\n  lazy_load: ->\r\n    return if not @$el.is_in_screen()\r\n    @load()\r\n\r\n  load: ->\r\n    return if @loaded\r\n    @loaded = true\r\n\r\n    w = Math.round @layout_width\r\n    h = Math.round @layout_height\r\n\r\n    img = jQuery \"<img>\"\r\n      .attr 'src', @get_png_url(w, h)\r\n      .attr 'draggable', false\r\n      .css\r\n        'opacity': 0\r\n        'width': '100%'\r\n        'height': '100%'\r\n      .on 'load', =>\r\n        img.animate\r\n          'opacity': 1\r\n        , 400, =>\r\n          @$ibox.css 'background', 'none'\r\n      .appendTo @$ibox\r\n\r\n  remove: ->\r\n    @$el.remove()\r\n\r\n###\r\n用途：\r\n  图像网格，支持以多种布局来显示图像\r\n  同时支持滚动加载更多图片\r\n用法：\r\n  haml:\r\n    .grid\r\n      .images\r\n        .image{:data => {:url => '', :width => '', :height => '', :ave => ''}}\r\n        .image{:data => {:url => '', :width => '', :height => '', :ave => ''}}\r\n        .image{:data => {:url => '', :width => '', :height => '', :ave => ''}}\r\n\r\n  coffee:\r\n    ig = new ImageGrid jQuery('.images'), {\r\n      layout: GridLayout\r\n      viewport: jQuery('.grid')\r\n    }\r\n    ig.render()\r\n###\r\nclass ImageGrid\r\n  constructor: (@$el, config = {})->\r\n    @$viewport = config.viewport || jQuery(document)\r\n    @layout = new (config.layout || GridLayout) @\r\n\r\n    @$el.css\r\n      'position': 'relative'\r\n    \r\n    @image_hash = {}\r\n    for dom in @$el.find('.image')\r\n      @add_image jQuery(dom)\r\n\r\n    @load_more_url = @$el.data('load-more-url')\r\n    @bind_events()\r\n\r\n  bind_events: ->\r\n    @$viewport.on 'scroll', (evt)=>\r\n      @lazy_load_images()\r\n      @load_more() if @layout.need_load_more()\r\n\r\n  add_image: ($image)->\r\n    img = new Image $image\r\n    jQuery('<div>')\r\n      .addClass('icheck')\r\n      .appendTo img.$el\r\n    @image_hash[$image.data('id')] = img\r\n\r\n  remove_img_ids: (ids)->\r\n    for id in ids\r\n      img = @image_hash[id]\r\n      img.remove()\r\n      delete @image_hash[id]\r\n    @render()\r\n\r\n\r\n\r\n\r\n  each_image: (func)->\r\n    # for idx in [0 ... @images.length]\r\n    #   func idx, @images[idx] \r\n    idx = 0\r\n    for id, img of @image_hash\r\n      func idx, img\r\n      idx++\r\n\r\n  # 对所有图片重新布局\r\n  render: ->\r\n    @layout.render()\r\n    setTimeout ->\r\n      jQuery('.nano').nanoScroller {\r\n        alwaysVisible: true\r\n        # flash: true\r\n      }\r\n\r\n  lazy_load_images: ->\r\n    image.lazy_load() for id, image of @image_hash\r\n\r\n  get_width: ->\r\n    @$el.width()\r\n\r\n  load_more: ->\r\n    return if @$el.hasClass 'end'\r\n    return if @$el.hasClass 'loading'\r\n    @$el.addClass 'loading'\r\n    page = @$el.data('page') || 1\r\n    jQuery.ajax\r\n      url: @load_more_url\r\n      type: 'GET'\r\n      data:\r\n        page: page + 1\r\n      success: (res)=>\r\n        $images = jQuery(res).find('.grid .images .image')\r\n\r\n        if $images.length\r\n          $images.each (idx, el)=>\r\n            $image = jQuery(el)\r\n            id = $image.data('id')            # 这两行用于静态页面，\r\n            $image.data('id', \"#{id}#{page}\") # 集成时去掉\r\n            @$el.append $image\r\n            @add_image $image\r\n\r\n          @render()\r\n          @$el.removeClass 'loading'\r\n          @$el.data 'page', page + 1\r\n\r\n        else\r\n          @$el.removeClass 'loading'\r\n          @$el.addClass 'end'\r\n\r\n\r\n\r\n# ----------\r\n# 复选图片\r\n\r\nclass ImageSelector\r\n  constructor: (@$el)->\r\n    @bind_events()\r\n\r\n  bind_events: ->\r\n    that = this\r\n    @$el.on 'click', '.image .icheck', ->\r\n      jQuery(this).toggleClass('selected')\r\n      that.refresh_selected()\r\n\r\n    jQuery('.checkstatus a.check').on 'click', ->\r\n      $checkstatus = jQuery(this).closest('.checkstatus')\r\n      if $checkstatus.hasClass('none') or $checkstatus.hasClass('some')\r\n        that.$el.find('.image .icheck').addClass('selected')\r\n        that.refresh_selected()\r\n        return\r\n      if $checkstatus.hasClass('all')\r\n        that.$el.find('.image .icheck').removeClass('selected')\r\n        that.refresh_selected()\r\n        return\r\n\r\n  refresh_selected: ->\r\n    length = @$el.find('.image .icheck.selected').length\r\n    all_length = @$el.find('.image .icheck').length\r\n    jQuery('.opbar .checkstatus span.n').text length\r\n    jQuery('.opbar .checkstatus').removeClass('none some all')\r\n    if length is 0\r\n      jQuery('.opbar .checkstatus').addClass('none')\r\n    else if length < all_length\r\n      jQuery('.opbar .checkstatus').addClass('some')\r\n    else\r\n      jQuery('.opbar .checkstatus').addClass('all')\r\n\r\n    if length > 0\r\n      jQuery('.opbar .btns .bttn').removeClass('disabled')\r\n    else\r\n      jQuery('.opbar .btns .bttn').addClass('disabled')\r\n\r\n  get_selected: ->\r\n    @$el.find('.image .icheck.selected').closest('.image')\r\n\r\n\r\njQuery(document).on 'ready page:load', ->\r\n  if jQuery('.grid .images').length\r\n    ig = new ImageGrid jQuery('.grid .images'), {\r\n      # layout: FlowLayout\r\n      layout: GridLayout\r\n      viewport: jQuery('.grid .nano-content')\r\n    }\r\n\r\n    ig.render()\r\n\r\n    jQuery(window)\r\n      .off 'resize'\r\n      .on 'resize', -> \r\n        ig.render()\r\n\r\n    ise = new ImageSelector jQuery('.grid .images')\r\n\r\n  # if jQuery('.page-image-show').length\r\n  #   jQuery(document).delegate 'input.url', 'click', ->\r\n  #     jQuery(this).select()\r\n\r\n    popbox_delete = new PopBox jQuery('.popbox.template.delete')\r\n    jQuery('.opbar a.bttn.delete').on 'click', ->\r\n      popbox_delete.show ->\r\n        len = ise.get_selected().length\r\n        popbox_delete.$inner.find('span.n').text len\r\n        popbox_delete.bind_ok ->\r\n          ids = for image in ise.get_selected()\r\n            jQuery(image).data('id')\r\n          console.log ids\r\n          jQuery.ajax\r\n            url: '/'\r\n            data: \r\n              ids: ids\r\n            success: (res)->\r\n              ig.remove_img_ids ids\r\n              popbox_delete.close()\r\n              ise.refresh_selected()\r\n\r\n\r\n    popbox_download = new PopBox jQuery('.popbox.template.download')\r\n    jQuery('.opbar a.bttn.download').on 'click', ->\r\n      popbox_download.show ->\r\n        len = ise.get_selected().length\r\n        popbox_download.$inner.find('span.n').text len\r\n        popbox_download.bind_ok ->\r\n          ids = for image in ise.get_selected()\r\n            jQuery(image).data('id')\r\n          console.log ids\r\n          alert('下载')\r\n\r\n\r\njQuery(document).on 'click', 'a.btn-upload', ->\r\n  $panel = jQuery('.upload-panel')\r\n  $panel.addClass('opened')\r\n\r\njQuery(document).on 'click', 'a.close-panel', ->\r\n  $panel = jQuery('.upload-panel')\r\n  $panel.removeClass('opened')"]}