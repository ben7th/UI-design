{"version":3,"sources":["ui.coffee"],"names":[],"mappings":"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","file":"ui.js","sourceRoot":"/source/","sourcesContent":["# 可能会用到 turbolinks\r\n# turbolinks 事件加载参考\r\n# https://github.com/rails/turbolinks/#no-jquery-or-any-other-library\r\n\r\n###\r\n  图片加载类\r\n###\r\nclass Image\r\n  constructor: (@$el)->\r\n    @ave    = @$el.data 'ave' # 平均色值\r\n    @width  = @$el.data 'width' # 原始宽\r\n    @height = @$el.data 'height' # 原始高\r\n    @url    = @$el.data 'url' # 原始地址\r\n\r\n    @$el.css\r\n      'position': 'absolute'\r\n\r\n    @$ibox = jQuery('<div>')\r\n      .addClass 'ibox'\r\n      .css \r\n        'background-color': @ave\r\n        'position': 'absolute'\r\n        'top': 0\r\n        'left': 0\r\n        'right': 0\r\n        'bottom': 0\r\n      .appendTo @$el\r\n\r\n  get_png_url: (width, height)->\r\n    \"#{@url}@#{width}w_#{height}h_1e_1c.png\"\r\n\r\n  pos: (left, top, width, height)->\r\n    @$el.css\r\n      'left'   : @layout_left = left\r\n      'top'    : @layout_top = top\r\n      'width'  : @layout_width = width\r\n      'height' : @layout_height = height\r\n\r\n  lazy_load: ->\r\n    return if not @$el.is_in_screen()\r\n    @load()\r\n\r\n  load: ->\r\n    return if @loaded\r\n    @loaded = true\r\n\r\n    w = Math.round @layout_width\r\n    h = Math.round @layout_height\r\n\r\n    img = jQuery \"<img>\"\r\n      .attr 'src', @get_png_url(w, h)\r\n      .attr 'draggable', false\r\n      .css\r\n        'opacity': 0\r\n        'width': '100%'\r\n        'height': '100%'\r\n      .on 'load', =>\r\n        img.animate\r\n          'opacity': 1\r\n        , 400, =>\r\n          @$ibox.css 'background', 'none'\r\n      .appendTo @$ibox\r\n\r\n###\r\n用途：\r\n  图像网格，支持以多种布局来显示图像\r\n  同时支持滚动加载更多图片\r\n用法：\r\n  haml:\r\n    .grid\r\n      .images\r\n        .image{:data => {:url => '', :width => '', :height => '', :ave => ''}}\r\n        .image{:data => {:url => '', :width => '', :height => '', :ave => ''}}\r\n        .image{:data => {:url => '', :width => '', :height => '', :ave => ''}}\r\n\r\n  coffee:\r\n    ig = new ImageGrid jQuery('.images'), {\r\n      layout: GridLayout\r\n      viewport: jQuery('.grid')\r\n    }\r\n    ig.render()\r\n###\r\nclass ImageGrid\r\n  constructor: (@$el, config = {})->\r\n    @$viewport = config.viewport || jQuery(document)\r\n    @layout = new (config.layout || GridLayout) @\r\n\r\n    @$el.css\r\n      'position': 'relative'\r\n    \r\n    @images = []\r\n    for dom in @$el.find('.image')\r\n      @add_image jQuery(dom)\r\n\r\n    @load_more_url = @$el.data('load-more-url')\r\n    @bind_events()\r\n\r\n  bind_events: ->\r\n    @$viewport.on 'scroll', (evt)=>\r\n      @lazy_load_images()\r\n      @load_more() if @layout.need_load_more()\r\n\r\n  add_image: ($image)->\r\n    img = new Image $image\r\n    jQuery('<div>')\r\n      .addClass('icheck')\r\n      .appendTo img.$el\r\n    @images.push img\r\n\r\n  each_image: (func)->\r\n    for idx in [0 ... @images.length]\r\n      func idx, @images[idx] \r\n\r\n  # 对所有图片重新布局\r\n  render: ->\r\n    @layout.render()\r\n    setTimeout ->\r\n      jQuery('.nano').nanoScroller {\r\n        alwaysVisible: true\r\n        # flash: true\r\n      }\r\n\r\n  lazy_load_images: ->\r\n    image.lazy_load() for image in @images\r\n\r\n  get_width: ->\r\n    @$el.width()\r\n\r\n  load_more: ->\r\n    return if @$el.hasClass 'end'\r\n    return if @$el.hasClass 'loading'\r\n    @$el.addClass 'loading'\r\n    page = @$el.data('page') || 1\r\n    jQuery.ajax\r\n      url: @load_more_url\r\n      type: 'GET'\r\n      data:\r\n        page: page + 1\r\n      success: (res)=>\r\n        $images = jQuery(res).find('.grid .images .image')\r\n\r\n        if $images.length\r\n          $images.each (idx, el)=>\r\n            $image = jQuery(el)\r\n            @$el.append $image\r\n            @add_image $image\r\n\r\n          @render()\r\n          @$el.removeClass 'loading'\r\n          @$el.data 'page', page + 1\r\n\r\n        else\r\n          @$el.removeClass 'loading'\r\n          @$el.addClass 'end'\r\n\r\n\r\njQuery ->\r\n  if jQuery('.grid .images').length\r\n    ig = new ImageGrid jQuery('.grid .images'), {\r\n      # layout: FlowLayout\r\n      layout: GridLayout\r\n      viewport: jQuery('.grid .nano-content')\r\n    }\r\n    ig.render()\r\n\r\n    jQuery(window).on 'resize', -> \r\n      ig.render()\r\n\r\n  # if jQuery('.page-image-show').length\r\n  #   jQuery(document).delegate 'input.url', 'click', ->\r\n  #     jQuery(this).select()"]}